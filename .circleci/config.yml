version: 2.0
jobs:
  build:
    docker:
      - image: circleci/node:10.13.0
    steps:
      - checkout
      - run:
          name: install
          command: npm install --only=dev
      - run:
          name: lint
          command: npx eslint --fix-dry-run 'types/*'
      - setup_remote_docker
      - run:
          name: integration test
          command: |
            # Start Plug Node
            docker run -d \
                       -p 9944:9944 \
                       --entrypoint /usr/local/bin/plug \
                       plugnet/plugblockchain:1.0.0-rc2 \
                       --dev \
                       --unsafe-ws-external
            npm install --only=dev && npm run test
